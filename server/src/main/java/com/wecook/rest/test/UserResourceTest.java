package com.wecook.rest.test;

import com.google.gson.Gson;
import com.google.gson.JsonArray;
import com.google.gson.JsonObject;
import com.wecook.model.StandardUser;
import com.wecook.model.User;
import com.wecook.rest.UserResource;
import com.wecook.rest.utils.JwtManager;
import jakarta.ws.rs.core.Response;
import org.glassfish.grizzly.http.server.Request;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.lenient;
import static org.mockito.Mockito.mock;

@ExtendWith(MockitoExtension.class)
public class UserResourceTest {
    @Mock
    private SessionFactory sessionFactory;

    @Mock
    private Session session;

    @Mock
    private Gson gson;

    @Mock
    private Request context;

    @InjectMocks
    private UserResource userResource;

    private StandardUser standardUser;

    @BeforeEach
    public void setUp() {
        lenient().when(sessionFactory.openSession()).thenReturn(session);
        User user = mock(User.class);
        Session session = mock(Session.class);
        lenient().doReturn(user).when(session).get(User.class, 1);
        String token = JwtManager.getInstance().generateToken(user);

        lenient().doReturn("Bearer "+token).when(context).getHeader("Authorization");
    }

    @Test
    public void testTC1UpdateUserValid() {
        JsonObject jsonRequestPatch = new JsonObject();
        jsonRequestPatch.addProperty("favoriteDish", "Polpette al sugo");
        jsonRequestPatch.addProperty("foodPreference", "OMNIVORE");
        jsonRequestPatch.addProperty("profilePicture", "data:image/jpeg;base64,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");
        String jsonStringPatch = jsonRequestPatch.toString();
        InputStream inputStream = new ByteArrayInputStream(jsonStringPatch.getBytes(StandardCharsets.UTF_8));
        lenient().when(context.getInputStream()).thenReturn(inputStream);

        Response response = userResource.patch(context, 1);
        assertEquals(Response.Status.OK.getStatusCode(), response.getStatus());

        JsonObject jsonRequestPut = new JsonObject();
        JsonArray jsonArray = new JsonArray();
        jsonArray.add("MILK");
        jsonArray.add("PEANUTS");
        jsonRequestPut.add("allergies", jsonArray);
        jsonRequestPut.addProperty("operation", "add");
        String jsonStringPut = jsonRequestPut.toString();
        InputStream inputStreamPut = new ByteArrayInputStream(jsonStringPut.getBytes(StandardCharsets.UTF_8));
        lenient().when(context.getInputStream()).thenReturn(inputStreamPut);

        Response responsePut = userResource.putAllergies(context, 1);

        assertEquals(Response.Status.OK.getStatusCode(), responsePut.getStatus());
    }

    @Test
    public void testTC2UpdateUserWithoutFoodPreferences() {
        JsonObject jsonRequestPatch = new JsonObject();
        jsonRequestPatch.addProperty("favoriteDish", "Polpette al sugo");
        String jsonStringPatch = jsonRequestPatch.toString();
        InputStream inputStream = new ByteArrayInputStream(jsonStringPatch.getBytes(StandardCharsets.UTF_8));
        lenient().when(context.getInputStream()).thenReturn(inputStream);

        Response response = userResource.patch(context, 1);
        assertEquals(Response.Status.OK.getStatusCode(), response.getStatus());

        JsonObject jsonRequestPut = new JsonObject();
        JsonArray jsonArray = new JsonArray();
        jsonArray.add("MILK");
        jsonArray.add("PEANUTS");
        jsonRequestPut.add("allergies", jsonArray);
        jsonRequestPut.addProperty("operation", "add");
        String jsonStringPut = jsonRequestPut.toString();
        InputStream inputStreamPut = new ByteArrayInputStream(jsonStringPut.getBytes(StandardCharsets.UTF_8));
        lenient().when(context.getInputStream()).thenReturn(inputStreamPut);

        Response responsePut = userResource.putAllergies(context, 1);

        assertEquals(Response.Status.OK.getStatusCode(), responsePut.getStatus());
    }

    @Test
    public void testTC3FailedUpdateUserFavoriteDish() {
        JsonObject jsonRequestPatch = new JsonObject();
        jsonRequestPatch.addProperty("favoriteDish", "#Polpette! al <sugo>");
        String jsonStringPatch = jsonRequestPatch.toString();
        InputStream inputStream = new ByteArrayInputStream(jsonStringPatch.getBytes(StandardCharsets.UTF_8));
        lenient().when(context.getInputStream()).thenReturn(inputStream);

        Response response = userResource.patch(context, 1);
        assertEquals(Response.Status.BAD_REQUEST.getStatusCode(), response.getStatus());

        JsonObject jsonRequestPut = new JsonObject();
        JsonArray jsonArray = new JsonArray();
        jsonArray.add("MILK");
        jsonArray.add("PEANUTS");
        jsonRequestPut.add("allergies", jsonArray);
        jsonRequestPut.addProperty("operation", "add");
        String jsonStringPut = jsonRequestPut.toString();
        InputStream inputStreamPut = new ByteArrayInputStream(jsonStringPut.getBytes(StandardCharsets.UTF_8));
        lenient().when(context.getInputStream()).thenReturn(inputStreamPut);

        Response responsePut = userResource.putAllergies(context, 1);

        assertEquals(Response.Status.OK.getStatusCode(), responsePut.getStatus());
    }

    @Test
    public void testTC4FailedUpdatePhoto() {
        JsonObject jsonRequestPatch = new JsonObject();
        jsonRequestPatch.addProperty("favoriteDish", "Polpette al sugo");
        jsonRequestPatch.addProperty("foodPreference", "OMNIVORE");
        jsonRequestPatch.addProperty("picture", "VUMgMjogU3VwZXJ2aXNpb25lIFNlZ25hbGF6aW9uZSBDb21tZW50aQ0KUGFyYW1ldHJpOiBjb21tZW50byAtIHNlZ25hbGF6aW9uZUNvbW1lbnRvDQpDYXRlZ29yaWU6IFJlbGF0aXZhbWVudGUgYWkgcGFyYW1ldHJpIGRpc3Rpbmd1aWFtbyAyIGNhdGVnb3JpZQ0KQ29tbWVudG8gcHJlc2VudGUgbmVsIGRhdGFiYXNlDQpTZWduYWxhemlvbmUgY29tbWVudG8gcHJlc2VudGUgbmVsIGRhdGFiYXNlDQoNClNjZWx0ZSBlIHZpbmNvbGk6IExlIHBvc3NpYmlsaSBvcHppb25pIGUgdmluY29saSBwZXIgbGUgMiBjYXRlZ29yaWUgc29ubyBsZSBzZWd1ZW50aToNCmNvbW1lbnRvDQpDb21tZW50byBwcmVzZW50ZSBuZWwgZGF0YWJhc2UgY29uIHN0YXRvIGRpdmVyc28gZGEg4oCcRUxJTUlOQVRP4oCdIFtwcm9wZXJ0eSBjb21tZW50X2V4aXN0c10NCkNvbW1lbnRvIE5PTiBwcmVzZW50ZSBuZWwgZGF0YWJhc2UgDQpzZWduYWxhemlvbmVDb21tZW50bw0KU2VnbmFsYXppb25lIGNvbW1lbnRvIHByZXNlbnRlIG5lbCBkYXRhYmFzZSBbaWYgY29tbWVudG9fZXhpc3RzXQ0KU2VnbmFsYXppb25lIGNvbW1lbnRvIE5PTiBwcmVzZW50ZSBuZWwgZGF0YWJhc2UgW2lmIGNvbW1lbnRvX2V4aXN0c10NCg0KVGVzdCBmcmFtZToNCmNvbW1lbnRvLmEsIHNlZ25hbGF6aW9uZUNvbW1lbnRvLmEg4oaSIE9SQUNPTE86IFNlZ25hbGF6aW9uZSB2aXNpYmlsZSBuZWxsYSBwYWdpbmEgZGVsbGUgc2VnbmFsYXppb25pIGRlaSBjb21tZW50aQ0KY29tbWVudG8uYSwgc2VnbmFsYXppb25lQ29tbWVudG8uYiDihpIgT1JBQ09MTzogU2VnbmFsYXppb25lIG5vbiB2aXNpYmlsZSBuZWxsYSBwYWdpbmEgZGVsbGUgc2VnbmFsYXppb25pIGRlaSBjb21tZW50aQ0KDQpUZXN0IGNhc2U6DQpUQzENClBhcmFtZXRyaTogc2VnbmFsYXppb25lQ29tbWVudG8gcHJlc2VudGUgbmVsIGRhdGFiYXNlDQpSaXN1bHRhdG86IFNlZ25hbGF6aW9uZSB2aXNpYmlsZSBuZWxsYSBwYWdpbmEgZGVsbGUgc2VnbmFsYXppb25pIGRlaSBjb21tZW50aQ0KVEMyDQpQYXJhbWV0cmk6IHNlZ25hbGF6aW9uZUNvbW1lbnRvIG5vbiBwcmVzZW50ZSBuZWwgZGF0YWJhc2UNClJpc3VsdGF0bzogU2VnbmFsYXppb25lIG5vbiB2aXNpYmlsZSBuZWxsYSBwYWdpbmEgZGVsbGUgc2VnbmFsYXppb25pIGRlaSBjb21tZW50aQ0KDQpVQyAzOiBTdXBlcnZpc2lvbmUgU2VnbmFsYXppb25lIFBvc3QNClBhcmFtZXRyaTogY29tbWVudG8gLSBzZWduYWxhemlvbmVQb3N0DQpDYXRlZ29yaWU6IFJlbGF0aXZhbWVudGUgYWkgcGFyYW1ldHJpIGRpc3Rpbmd1aWFtbyAyIGNhdGVnb3JpZQ0KUG9zdCBwcmVzZW50ZSBuZWwgZGF0YWJhc2UNClNlZ25hbGF6aW9uZSBwb3N0IHByZXNlbnRlIG5lbCBkYXRhYmFzZQ0KDQpTY2VsdGUgZSB2aW5jb2xpOiBMZSBwb3NzaWJpbGkgb3B6aW9uaSBlIHZpbmNvbGkgcGVyIGxlIDIgY2F0ZWdvcmllIHNvbm8gbGUgc2VndWVudGk6DQpwb3N0DQpQb3N0IHByZXNlbnRlIG5lbCBkYXRhYmFzZSBjb24gc3RhdG8gZGl2ZXJzbyBkYSDigJxFTElNSU5BVE/igJ0gW3Byb3BlcnR5IHBvc3RfZXhpc3RzXQ0KUG9zdCBOT04gcHJlc2VudGUgbmVsIGRhdGFiYXNlDQpzZWduYWxhemlvbmVQb3N0DQpTZWduYWxhemlvbmUgcG9zdCBwcmVzZW50ZSBuZWwgZGF0YWJhc2UgW2lmIHBvc3RfZXhpc3RzXQ0KU2VnbmFsYXppb25lIHBvc3QgTk9OIHByZXNlbnRlIG5lbCBkYXRhYmFzZSBbaWYgcG9zdF9leGlzdHNdDQoNClRlc3QgZnJhbWU6DQpwb3N0LmEsIHNlZ25hbGF6aW9uZVBvc3QuYSDihpIgT1JBQ09MTzogIFNlZ25hbGF6aW9uZSB2aXNpYmlsZSBuZWxsYSBwYWdpbmEgZGVsbGUgc2VnbmFsYXppb25pIGRlaSBwb3N0DQpwb3N0LmEsIHNlZ25hbGF6aW9uZVBvc3QuYiDihpIgT1JBQ09MTzogU2VnbmFsYXppb25lIG5vbiB2aXNpYmlsZSBuZWxsYSBwYWdpbmEgZGVsbGUgc2VnbmFsYXppb25pIGRlaSBwb3N0DQoNClRlc3QgY2FzZToNClRDMQ0KUGFyYW1ldHJpOiBzZWduYWxhemlvbmVQb3N0IHByZXNlbnRlIG5lbCBkYXRhYmFzZQ0KUmlzdWx0YXRvOiBTZWduYWxhemlvbmUgdmlzaWJpbGUgbmVsbGEgcGFnaW5hIGRlbGxlIHNlZ25hbGF6aW9uaSBkZWkgcG9zdA0KVEMyDQpQYXJhbWV0cmk6IHBvc3QgKHByZXNlbnRlIG5lbCBkYXRhYmFzZSkgZSBjb250ZW51dG9Db21tZW50by5iDQpSaXN1bHRhdG86IFNlZ25hbGF6aW9uZSBub24gdmlzaWJpbGUgbmVsbGEgcGFnaW5hIGRlbGxlIHNlZ25hbGF6aW9uaSBkZWkgcG9zdA0KDQpVQyA0OiBFbGltaW5hemlvbmUgY29tbWVudG8gc2VnbmFsYXRvDQpQYXJhbWV0cmk6IGNvbW1lbnRvIC0gY29uZmVybWFFbGltaW5hemlvbmUNCkNhdGVnb3JpZTogUmVsYXRpdmFtZW50ZSBhaSBwYXJhbWV0cmkgZGlzdGluZ3VpYW1vIDIgY2F0ZWdvcmllDQpDb21tZW50byBwcmVzZW50ZSBuZWwgZGF0YWJhc2UNCkF6aW9uZSBkZWwgbW9kZXJhdG9yZSByaXNwZXR0byBhbCBtZXNzYWdnaW8gZGkgZWxpbWluYXppb25lDQoNClNjZWx0ZSBlIHZpbmNvbGk6IExlIHBvc3NpYmlsaSBvcHppb25pIGUgdmluY29saSBwZXIgbGUgMiBjYXRlZ29yaWUgc29ubyBsZSBzZWd1ZW50aToNCmNvbW1lbnRvDQpDb21tZW50byBwcmVzZW50ZSBuZWwgZGF0YWJhc2UgY29uIHN0YXRvIGRpdmVyc28gZGEg4oCcRUxJTUlOQVRP4oCdIFtwcm9wZXJ0eSBjb21tZW50X2V4aXN0c10NCkNvbW1lbnRvIE5PTiBwcmVzZW50ZSBuZWwgZGF0YWJhc2UNCmNvbmZlcm1hRWxpbWluYXppb25lDQpFbGltaW5hemlvbmUgY29uZmVybWF0YSBbaWYgY29tbWVudF9leGlzdHNdDQpFbGltaW5hemlvbmUgYW5udWxsYXRhIFtpZiBjb21tZW50X2V4aXN0c10NCg0KVGVzdCBmcmFtZToNCmNvbW1lbnRvLmEsIGNvbmZlcm1hRWxpbWluYXppb25lLmEg4oaSIE9SQUNPTE86IENvbW1lbnRvIGVsaW1pbmF0bywgbm9uIHBpw7kgdmlzaWJpbGUgc3VsIHBvc3Qgb3JpZ2luYWxlIGUgbm9uIHBpw7kgdmlzaWJpbGUgbmVsbGEgbGlzdGEgZGVsbGUgc2VnbmFsYXppb25pDQpjb21tZW50by5hLCBjb25mZXJtYUVsaW1pbmF6aW9uZS5iIOKGkiBPUkFDT0xPOiBDb21tZW50byBOT04gZWxpbWluYXRvLCBhbmNvcmEgdmlzaWJpbGUgc3VsIHBvc3Qgb3JpZ2luYWxlIGUgbm9uIHBpw7kgdmlzaWJpbGUgbmVsbGEgbGlzdGEgZGVsbGUgc2VnbmFsYXppb25pDQpUZXN0IGNhc2U6DQpUQzENClBhcmFtZXRyaTogY29tbWVudG8gKHByZXNlbnRlIG5lbCBkYXRhYmFzZSkgZSBjb25mZXJtYUVsaW1pbmF6aW9uZSAo4oCcU0nigJ0pDQpSaXN1bHRhdG86IENvbW1lbnRvIGVsaW1pbmF0bywgbm9uIHBpw7kgdmlzaWJpbGUgc3VsIHBvc3Qgb3JpZ2luYWxlIGUgbm9uIHBpw7kgdmlzaWJpbGUgbmVsbGEgbGlzdGEgZGVsbGUgc2VnbmFsYXppb25pDQpUQzINClBhcmFtZXRyaTogY29tbWVudG8gKHByZXNlbnRlIG5lbCBkYXRhYmFzZSkgZSBjb25mZXJtYUVsaW1pbmF6aW9uZSAo4oCcTk/igJ0pDQpSaXN1bHRhdG86IENvbW1lbnRvIE5PTiBlbGltaW5hdG8sIGFuY29yYSB2aXNpYmlsZSBzdWwgcG9zdCBvcmlnaW5hbGUgZSBub24gcGnDuSB2aXNpYmlsZSBuZWxsYSBsaXN0YSBkZWxsZSBzZWduYWxhemlvbmkNClVDIDU6IEVsaW1pbmF6aW9uZSBwb3N0IHNlZ25hbGF0bw0KUGFyYW1ldHJpOiBwb3N0IC0gY29uZmVybWFFbGltaW5hemlvbmUNCkNhdGVnb3JpZTogUmVsYXRpdmFtZW50ZSBhaSBwYXJhbWV0cmkgZGlzdGluZ3VpYW1vIDIgY2F0ZWdvcmllDQpQb3N0IHNlZ25hbGF0byBwcmVzZW50ZSBuZWwgZGF0YWJhc2UNCkF6aW9uZSBkZWwgbW9kZXJhdG9yZSByaXNwZXR0byBhbCBtZXNzYWdnaW8gZGkgZWxpbWluYXppb25lDQoNClNjZWx0ZSBlIHZpbmNvbGk6IExlIHBvc3NpYmlsaSBvcHppb25pIGUgdmluY29saSBwZXIgbGUgMiBjYXRlZ29yaWUgc29ubyBsZSBzZWd1ZW50aToNCnBvc3QNClBvc3QgcHJlc2VudGUgbmVsIGRhdGFiYXNlIGNvbiBzdGF0byBkaXZlcnNvIGRhIOKAnEVMSU1JTkFUT+KAnSBbcHJvcGVydHkgcG9zdF9leGlzdHNdDQpQb3N0IE5PTiBwcmVzZW50ZSBuZWwgZGF0YWJhc2UNCmNvbmZlcm1hRWxpbWluYXppb25lDQpFbGltaW5hemlvbmUgY29uZmVybWF0YSBbaWYgcG9zdF9leGlzdHNdIA0KRWxpbWluYXppb25lIGFubnVsbGF0YSBbaWYgcG9zdF9leGlzdHNdDQoNClRlc3QgZnJhbWU6DQpwb3N0LmEsIGNvbmZlcm1hRWxpbWluYXppb25lLmEg4oaSIE9SQUNPTE86IFBvc3QgZWxpbWluYXRvLCBub24gcGnDuSB2aXNpYmlsZSBuZWxsYSBsaXN0YSBkZWkgcG9zdCwgbm9uIHBpw7kgdmlzaWJpbGUgc3VsIHByb2ZpbG8gZGVsbOKAmXV0ZW50ZSBjaGUgbG8gaGEgcHViYmxpY2F0byBlIG5vbiBwacO5IHZpc2liaWxlIHN1bGxhIGxpc3RhIGRlbGxlIHNlZ25hbGF6aW9uaQ0KcG9zdC5hLCBjb25mZXJtYUVsaW1pbmF6aW9uZS5iIOKGkiBPUkFDT0xPOiBQb3N0IE5PTiBlbGltaW5hdG8sIGFuY29yYSB2aXNpYmlsZSBuZWxsYSBsaXN0YSBkZWkgcG9zdCwgYW5jb3JhIHZpc2liaWxlIHN1bCBwcm9maWxvIGRlbGzigJl1dGVudGUgY2hlIGxvIGhhIHB1YmJsaWNhdG8gZSBub24gcGnDuSB2aXNpYmlsZSBzdWxsYSBsaXN0YSBkZWxsZSBzZWduYWxhemlvbmkNCg0KVGVzdCBjYXNlOg0KVEMxDQpQYXJhbWV0cmk6IHBvc3QgKHByZXNlbnRlIG5lbCBkYXRhYmFzZSkgZSBjb25mZXJtYUVsaW1pbmF6aW9uZSAo4oCcU0nigJ0pDQpSaXN1bHRhdG86IFBvc3QgZWxpbWluYXRvLCBub24gcGnDuSB2aXNpYmlsZSBuZWxsYSBsaXN0YSBkZWkgcG9zdCwgbm9uIHBpw7kgdmlzaWJpbGUgc3VsIHByb2ZpbG8gZGVsbOKAmXV0ZW50ZSBjaGUgbG8gaGEgcHViYmxpY2F0byBlIG5vbiBwacO5IHZpc2liaWxlIHN1bGxhIGxpc3RhIGRlbGxlIHNlZ25hbGF6aW9uaQ0KVEMyDQpQYXJhbWV0cmk6IHBvc3QgKHByZXNlbnRlIG5lbCBkYXRhYmFzZSkgZSBjb25mZXJtYUVsaW1pbmF6aW9uZSAo4oCcTk/igJ0pDQpSaXN1bHRhdG86IFBvc3QgTk9OIGVsaW1pbmF0bywgYW5jb3JhIHZpc2liaWxlIG5lbGxhIGxpc3RhIGRlaSBwb3N0LCBhbmNvcmEgdmlzaWJpbGUgc3VsIHByb2ZpbG8gZGVsbOKAmXV0ZW50ZSBjaGUgbG8gaGEgcHViYmxpY2F0byBlIG5vbiBwacO5IHZpc2liaWxlIHN1bGxhIGxpc3RhIGRlbGxlIHNlZ25hbGF6aW9uaQ0KVUMgNiAtIDc6IEFnZ2l1bnRhIC8gUmltb3ppb25lIGxpa2UNClBhcmFtZXRyaTogcG9zdCAtIHN0YXRvTGlrZVByZWNlZGVudGUNCkNhdGVnb3JpZTogUmVsYXRpdmFtZW50ZSBhaSBwYXJhbWV0cmkgZGlzdGluZ3VpYW1vIDIgY2F0ZWdvcmllDQpQb3N0IHByZXNlbnRlIG5lbCBkYXRhYmFzZQ0KU3RhdG8gcHJlY2VkZW50ZSBkZWwgbGlrZSBkYSBwYXJ0ZSBkZWxs4oCZdXRlbnRlDQoNClNjZWx0ZSBlIHZpbmNvbGk6IExlIHBvc3NpYmlsaSBvcHppb25pIGUgdmluY29saSBwZXIgbGUgMiBjYXRlZ29yaWUgc29ubyBsZSBzZWd1ZW50aToNCnBvc3QNClBvc3QgcHJlc2VudGUgbmVsIGRhdGFiYXNlIGNvbiBzdGF0byBkaXZlcnNvIGRhIOKAnEVMSU1JTkFUT+KAnSBbcHJvcGVydHkgcG9zdF9leGlzdHNdDQpQb3N0IE5PTiBwcmVzZW50ZSBuZWwgZGF0YWJhc2UNCnN0YXRvTGlrZVByZWNlZGVudGUNCkxpa2UgTk9OIGxhc2NpYXRvIGRhbGzigJl1dGVudGUgc3VsIHBvc3QgW2lmIHBvc3RfZXhpc3RzXQ0KTGlrZSBsYXNjaWF0byBkYWxs4oCZdXRlbnRlIHN1bCBwb3N0IFtpZiBwb3N0X2V4aXN0c10NCg0KVGVzdCBmcmFtZToNCnBvc3QuYSwgc3RhdG9MaWtlUHJlY2VkZW50ZS5hIOKGkiBPUkFDT0xPOiBMaWtlIHJlZ2lzdHJhdG8sIGNvbnRlZ2dpbyBpbmNyZW1lbnRhdG8gZSBpY29uYSBhZ2dpb3JuYXRhDQpwb3N0LmEsIHN0YXRvTGlrZVByZWNlZGVudGUuYiDihpIgT1JBQ09MTzogTGlrZSByaW1vc3NvLCBjb250ZWdnaW8gZGVjcmVtZW50YXRvIGUgaWNvbmEgYWdnaW9ybmF0YQ0KDQpUZXN0IGNhc2U6DQpUQzENClBhcmFtZXRyaTogcG9zdCAocHJlc2VudGUgbmVsIGRhdGFiYXNlKSBlIHN0YXRvTGlrZVByZWNlZGVudGUuYQ0KUmlzdWx0YXRvOiBMaWtlIHJlZ2lzdHJhdG8sIGNvbnRlZ2dpbyBpbmNyZW1lbnRhdG8gZSBpY29uYSBhZ2dpb3JuYXRhDQpUQzINClBhcmFtZXRyaTogcG9zdCAocHJlc2VudGUgbmVsIGRhdGFiYXNlKSBlIHN0YXRvTGlrZVByZWNlZGVudGUuYg0KUmlzdWx0YXRvOiBMaWtlIHJpbW9zc28sIGNvbnRlZ2dpbyBkZWNyZW1lbnRhdG8gZSBpY29uYSBhZ2dpb3JuYXRhDQo=");
        String jsonStringPatch = jsonRequestPatch.toString();
        InputStream inputStream = new ByteArrayInputStream(jsonStringPatch.getBytes(StandardCharsets.UTF_8));
        lenient().when(context.getInputStream()).thenReturn(inputStream);

        Response response = userResource.patch(context, 1);
        assertEquals(Response.Status.BAD_REQUEST.getStatusCode(), response.getStatus());

        JsonObject jsonRequestPut = new JsonObject();
        JsonArray jsonArray = new JsonArray();
        jsonArray.add("MILK");
        jsonArray.add("PEANUTS");
        jsonRequestPut.add("allergies", jsonArray);
        jsonRequestPut.addProperty("operation", "add");
        String jsonStringPut = jsonRequestPut.toString();
        InputStream inputStreamPut = new ByteArrayInputStream(jsonStringPut.getBytes(StandardCharsets.UTF_8));
        lenient().when(context.getInputStream()).thenReturn(inputStreamPut);

        Response responsePut = userResource.putAllergies(context, 1);

        assertEquals(Response.Status.OK.getStatusCode(), responsePut.getStatus());

    }
}
